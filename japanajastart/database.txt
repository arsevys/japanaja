

create table usuarios(
    id_usu serial primary key,
    nom_usu varchar(100) not null,
    cel_usu int ,
    correo_usu varchar(200),
    id_face_usu varchar(20),
    dni_usu char(8),
    contra_usu varchar(40) ,
    foto_usu text ,
    estre_usu int ,
    check (estre_usu between 0 and 100)
);

insert into usuarios (nom_usu,id_face_usu,estre_usu)
values ('javier','12232434',100);

select * from usuarios;

create table bancos (
    id_banco serial primary key,
    nom_banco varchar(200) not null
);

insert into bancos (nom_banco)
values ('bcp');






































select * from opciones where id_opc = 1 and estado_opc = 'activo'

select * from propuestas

alter table propuestas alter column mont_propu type decimal(5,2)

select c.num_cuent,b.nom_banco from usuarios as u
inner join cuentas as c
on u.id_usu = c.id_usu 
inner join bancos as b
on c.id_banco = b.id_banco
where u.id_usu = 2

insert into propuestas (id_usu,mont_propu,num_cuent_propu,id_opc)
values (2,300,'23232323232',1)

select * from opciones

select o.id_opc,o.estado_opc ,o.mont_opc,t.descr_tipo,
to_char(interval '24 hour' -(now() at time zone 'UTC' -interval '5 hour' - o.fecha_opc::timestamp),'HH24:MI:SS') as hora 
from opciones o inner join tipos t
on t.id_tipo=o.id_tipo inner join usuarios u
on u.id_usu=o.id_usu
where  o.estado_opc='activo' and u.id_usu=2 and
interval '24 hour' - (now() at time zone 'UTC' - interval '5 hour' - o.fecha_opc::timestamp ) > interval '-00:00:00'
order by o.id_opc desc limit 5


select us.nom_usu ,us.estre_usu,op.mont_opc,cast((to_date(op.fecha_opc,'YYYY-MM-DD') + 1) as text) as fecha_opc,op.id_opc,us.foto_usu ,to_char(interval '24 hour' - ( (now() at time zone 'UTC' - interval '5 hour') - op.fecha_opc::timestamp),'HH24:MI:SS') as hora
/*,coalesce(cu.num_cuent,'null'),coalesce(ban.nom_banco,'null')*/
from opciones as op
inner join usuarios as us
on op.id_usu = us.id_usu
inner join cuentas as cu
on us.id_usu = cu.id_usu
inner join bancos as ban
on ban.id_banco = cu.id_banco
where estado_opc = 'activo' and
interval '24 hour' - ( (now() at time zone 'UTC' - interval '5 hour' ) - op.fecha_opc::timestamp ) > interval '-00:00:00'

insert into cuentas ()
values ()

select * from cuentas

select * from usuarios

select * from opciones

insert into opciones (id_usu,mont_opc,num_cuent_opc,id_tipo,cod_sup_opc)
values (2,400,'43343d343',1,'22222-33')

update usuarios 
set estre_usu = 60
where id_usu = 2

 select us.nom_usu ,us.estre_usu,op.mont_opc,
  cast((to_date(op.fecha_opc,'YYYY-MM-DD') + 1) as text) as fecha_opc,op.id_opc,us.foto_usu ,
   to_char(interval '24 hour' - (now() at time zone 'UTC' - interval '5 hour' - op.fecha_opc::timestamp),'HH24:MI:SS') as hora 
   cu.num_cuent,ban.nom_banco from opciones as op
    inner join usuarios as us
     on op.id_usu = us.id_usu
      where estado_opc = 'activo' and
                     interval '24 hour' - (now() at time zone 'UTC' - interval '5 hour' - op.fecha_opc::timestamp ) > interval '-00:00:00'
create table cuentas (
    id_cuent serial primary key,
    id_usu int not null,
    num_cuent varchar(50) not null,
    id_banco int not null,
    foreign key (id_banco) references bancos(id_banco),
    foreign key (id_usu) references usuarios(id_usu)
);

insert into cuentas (id_usu,num_cuent,id_banco)
values (1,'432343543',1);

create table tipos (
    id_tipo serial primary key,
    descr_tipo varchar(250) not null
);

insert into tipos (descr_tipo)
values ('luz del sur');

create table opciones (
    id_opc serial primary key,
    id_usu int not null,
    mont_opc money not null,
    num_cuent_opc varchar(50) not null,
    id_tipo int not null,
    fecha_opc text default to_char(now() AT TIME ZONE 'UTC' - interval '5 hours','YYYY-MM-DD HH24:MI:SS'),
    estado_opc varchar(50) default 'activo',
    foreign key (id_usu) references usuarios(id_usu),
    foreign key (id_tipo) references tipos(id_tipo)
);

insert into opciones (id_usu,mont_opc,num_cuent_opc,id_tipo)
values (1,300,'2343434',1);

select * from opciones;


create table propuestas (
    id_propu serial primary key,
    id_usu int not null,
    mont_propu money not null,
    num_cuent_propu varchar(50) not null,
    fecha_propu text default to_char(now() AT TIME ZONE 'UTC' - interval '5 hours','YYYY-MM-DD HH24:MI:SS'),
    estado_propu varchar(50) default 'activo',
    foreign key (id_usu) references usuarios(id_usu)
);



create table transacciones (
    id_trans serial primary key,
    id_propu int not null,
    id_opc int not null,
    fecha_trans text default to_char(now() AT TIME ZONE 'UTC' - interval '5 hours','YYYY-MM-DD HH24:MI:SS'),
    foreign key (id_propu) references propuestas(id_propu),
    foreign key (id_opc) references opciones(id_opc)
);


